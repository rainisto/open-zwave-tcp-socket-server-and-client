<!--I want to make a generic websocket client and style the webpage in Drupal. This client is mainly a test.-->
<!DOCTYPE html>  
<html>  
    <head>
        <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
        <script type="text/javascript">
            $(document).ready(function() {
                window.WebSocket = window.WebSocket || window.MozWebSocket; 
                var websocket = new WebSocket('ws://openzwave-server-ip:6005', 'open-zwave');
                websocket.onopen = function () {
                    $('h1').html('Connected!');
                };
                websocket.onerror = function () {
                    $('h1').html('Error Connecting! Have you set the Openzwave-server-ip in this index.html file?');
                };
                websocket.onmessage = function (message) {
                    $('div').append(message.data + "<br />");
                }; 
                $('button').click(function(e) {
                    e.preventDefault();
                    websocket.send($('input').val());
                    $('input').val('');
                });
				if(navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(
						function(position) {
							// Log that this is the initial position.
							console.log("Initial Position Found");
							websocket.send("NEW_CLIENT~"+position.coords.latitude+"~"+position.coords.longitude);
						},
						function(error) {
							console.log("Something went wrong: ", error);
						},
						{
							timeout: (5 * 1000),
							maximumAge: (1000 * 60 * 15),
							enableHighAccuracy: true
						}
					);
					var positionTimer = navigator.geolocation.watchPosition(
						function(position) {
							// Log that a newer, perhaps more accurate
							// position has been found.
							console.log("Newer Position Found");
							websocket.send("UPDATE_CLIENT~"+position.coords.latitude+"~"+position.coords.longitude);
						}
					);

					// If the position hasn't updated within 5 minutes, stop
					// monitoring the position for changes.
					setTimeout(
						function(){
							// Clear the position watcher.
							navigator.geolocation.clearWatch(positionTimer);
						},
						(1000 * 60 * 5)
					);
				}
				websocket.send('ALIST');
            });
        </script>
        </head>
    <body>
        <h1>WebSocket Status</h1>
        <input type="text" />
        <button>Send Test Message</button>
        <div></div>
    </body>
</html>